{% extends 'map/map_base.html' %}
{% load static%}
{% block extra_map_css %}
{% load i18n %}
<!-- import psycopg2 -->
<style>

    
.border {
    padding: 6px 8px;
    border-style: groove;
    border-radius: 5px;
    margin:20px;
}
.info {
    padding: 6px 8px;
    font: 14px/16px Arial, Helvetica, sans-serif;
    background: rgba(255,255,255,0.8);
    box-shadow: 0 0 15px rgba(0,0,0,0.2);
    border-radius: 5px;
}
.info h4 {
    margin: 0 0 5px;
    color: #777;
}

/* .table{
  border-collapse: collapse;
  padding: 50px;
  font-weight: bold;

  
  /* background:rgba(191, 149, 233, 0.473); */

/* } */ */
table, th, td 
    {
        border-bottom: 1px solid #ddd;
        border-collapse: collapse;
        padding: 2px 3px;
        text-align: center;
    }
    th {
        font-weight:bold;
    }

.legend {
    line-height: 18px;
    color: #555;
}
.legend i {
   
    width: 18px;
    height: 18px;
    float: left;
    margin-right: 8px;
    opacity: 0.7;
}
.legendwet {
    line-height: 18px;
    color: #555;
}
.legendwet i {
    width: 18px;
    height: 18px;
    float: left;
    margin-right: 8px;
    opacity: 0.7;
}

/* css to customize Leaflet default styles  */
.leaflet-popup-content-wrapper {
    background: rgba(0, 0, 0, 0.9);
    color: #ffffff;
}

.leaflet-popup-content{
    font-weight: bold;
}
/* css for table tbinfo*/
#tbinfo {
  font-family: "Trebuchet MS", Arial, Helvetica, sans-serif;
  border-collapse: collapse;
  font-weight: bolder;
}

#tbinfo td, #tbinfo th {
  border: 3px solid #ddd;
  padding: 8px;
}

#tbinfo tr:nth-child(even){background-color: #f2f2f2;}

#tbinfo tr:hover {background-color: rgb(194, 92, 92);}

#tbinfo th {
  padding-top: 12px;
  padding-bottom: 12px;
  text-align: left;
  background-color: #4CAF50;
  color: white;
}
#checkboxes {
  display: none;
  /* border: 1px #dadada solid; */
}

#datepick {
  display: none;
  /* border: 1px #dadada solid; */
}

#checkboxes label {
  display: block;
  text-decoration-color: blue;
  text-align: left;
  margin: 10px;
}

#checkboxes2 {
  display: none;
  /* border: 1px #dadada solid; */
}

#checkboxes2 label {
  display: block;
  text-decoration-color: blue;
  text-align: left;
  margin: 10px;
}

#checkboxes3 {
  display: none;
  /* border: 1px #dadada solid; */
}

#checkboxes3 label {
  display: block;
  background-color:white;
  text-decoration-color: blue;
  text-align: left;
  margin: 10px;
}
#checkboxes7 {
        display: none;
        /* border: 1px #dadada solid; */
}
    
#checkboxes7 label {
        display: block;
        text-align: left;
        margin: 10px;
}

#checkboxes2 {
        display: none;
        /* border: 1px #dadada solid; */
}
    
#checkboxes2 label {
        display: block;
        text-align: left;
        margin: 10px;
}

#checkboxes5 {
        display: none;
        /* border: 1px #dadada solid; */
    }
    
#checkboxes5 label {
        display: block;
        text-align: left;
        margin: 10px;
}
#checkboxes4 {
        display: none;
        /* border: 1px #dadada solid; */
}
#checkboxeszone {
        display: none;
        /* border: 1px #dadada solid; */
}
#checkboxeszone label{
    display: block;
    text-align: left;
    margin: 10px;
}


#radiobutt {
    display:none;
}
#radiobutt label{
    display: block;
    text-align: left;
    margin: 20px;
}
    
#checkboxes2 label {
        display: block;
        text-align: left;
        margin: 10px;
}


/* Popup container - can be anything you want */
.popup {
  position: relative;
  display: inline-block;
  cursor: pointer;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  left: 50%;
  margin-right: -5px;
  border-width: 5px;
}

/* The actual popup */
.popup .popuptext {
  visibility: hidden;
  width: 160px;
  background-color: #555;
  color: #fff;
  text-align: center;
  border-radius: 6px;
  padding: 8px 0;
  position: absolute;
  z-index: 1;
  bottom: 125%;
  left: 50%;
  margin-left: -80px;
}

/* Popup arrow */
.popup .popuptext::after {
  content: "";
  position: absolute;
  top: 100%;
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: #555 transparent transparent transparent;
}

/* Toggle this class - hide and show the popup */
.popup .show {
  visibility: visible;
  -webkit-animation: fadeIn 1s;
  animation: fadeIn 1s;
}

/* Add animation (fade in the popup) */
@-webkit-keyframes fadeIn {
  from {opacity: 0;} 
  to {opacity: 1;}
}

@keyframes fadeIn {
  from {opacity: 0;}
  to {opacity:1 ;}
}

.form-control {
  width: 160px;
}

.circle {
        /* background-color: red; */
        border-radius: 50%;
    }
</style>

{% endblock extra_map_css%}

{% block map_content%}
  <!-- {% block sidebar %}
  {% endblock %} -->

  
  
    <div id="side-bar" style="background-color:  rgba(255, 255, 255);">                <!-- side-bar container -->
        <div class="mobileShow">

            <div style="text-align: center">
                <button style="display: inline-block ;position: relative; background: #000; opacity: 0.60;" id="closebutton" name="closebutton" class="btn btn-secondary"><span class="fa fa-bars"></span></button>
            </div>
    
        </div>
      <div>
        <div class="text-center border">


            <form id="projectList" style="width: 100%">

                <form>
                    <div class="multiselect">
                        <div class="selectBox" onclick="showCheckboxes3()">
                            <button type="button" class="btn btn-outline-dark" style="width: 90%;font-size:12px; "> {% trans "Geographical Hierarchy" %}</button>
                            <div class="overSelect"></div>
                        </div>
                        <div id="checkboxes3">
                            <div class="checkbox" id="boundary">
                                <label><input type="checkbox" value="{city}" onchange="getBoundaryru(this)"><span> {% trans "Mumbai-City district Boundary" %}</span></label>
                            </div>
                            <div class="checkbox" id="boundary">
                                <label><input type="checkbox" value="{wardGSouth}" onchange="getBoundaryru(this)"><span> {% trans "Mumbai Suburban -  Ward G-South" %}</span></label>
                            </div>
                            <div class="checkbox">
                                <label><span> {% trans "G-South Corporator Wards" %}</span></label>
                              </div>
                            <div class="checkbox">
                              <label><input type="checkbox" value="193" onchange="getBoundaryru(this)"><span> {% trans "193" %}</span></label>
                            </div>
                            <div class="checkbox">
                                <label><input type="checkbox" value="194" onchange="getBoundaryru(this)"><span> {% trans "194" %}</span></label>
                            </div>
                            <div class="checkbox">
                                <label><input type="checkbox" value="195" onchange="getBoundaryru(this)"><span> {% trans "195" %}</span></label>
                            </div>
                            <div class="checkbox">
                                <label><input type="checkbox" value="196" onchange="getBoundaryru(this)"><span> {% trans "196" %}</span></label>
                            </div>
                            <div class="checkbox">
                                <label><input type="checkbox" value="197" onchange="getBoundaryru(this)"><span> {% trans "197" %}</span></label>
                            </div>
                            <div class="checkbox">
                                <label><input type="checkbox" value="198" onchange="getBoundaryru(this)"><span> {% trans "198" %}</span></label>
                            </div>
                            <div class="checkbox">
                                <label><input type="checkbox" value="199" onchange="getBoundaryru(this)"><span> {% trans "199" %}</span></label>
                            </div>

                           
                        </div>
                        
                    </div>
                    
                    <br>
                      
                    <div class="multiselect">
                      <div class="selectBox" onclick="showCheckboxes7()">
                          <button type="button" class="btn btn-outline-dark" style="width: 90%;font-size:12px; "> {% trans "G/South Ward DP Polygons" %}</button>
                          <div class="overSelect"></div>
                      </div>
                      <div id="checkboxes7">
                        <!--<div class="checkbox">
                             <label><input type="checkbox" value="{zones}" id ="zones" onchange="getBoundaryru(this)"><span> {% trans "Zones" %}</span></label>
                          </div> -->
                          <!-- <div class="checkbox">
                              <label><input type="checkbox" value="{osmbuild}" id ="build_osm" onchange="getBoundaryru(this)"><span> {% trans "Building Polygons" %}</span></label>
                          </div>  -->
                          <div class="checkbox">
                            <label><input type="checkbox" value="education"  id ="education" onchange="getBoundaryDP(this)"><span> {% trans "Education" %}</span></label>
                          </div>
                          <div class="checkbox">
                            <label><input type="checkbox" value="health" id ="health" onchange="getBoundaryDP(this)"><span> {% trans "Health" %}</span></label>
                          </div> 
                          <div class="checkbox">
                            <label><input type="checkbox" value="{housing}" id ="housing" onchange="getBoundaryDP(this)"><span> {% trans "Housing" %}</span></label>
                          </div> 
                          <div class="checkbox">
                            <label><input type="checkbox" value="{municipal_service}" id ="municipal_service"  onchange="getBoundaryDP(this)"><span> {% trans "Municipal Services" %}</span></label>
                          </div> 
                          <div class="checkbox">
                            <label><input type="checkbox" value="{offices}" id ="offices"  onchange="getBoundaryDP(this)"><span> {% trans "Offices" %}</span></label>
                          </div>
                          <div class="checkbox">
                            <label><input type="checkbox" value="{open_spaces}" id ="open_spaces"  onchange="getBoundaryDP(this)"><span> {% trans "Open Spaces" %}</span></label>
                          </div>  
                         
                          <div class="checkbox">
                            <label><input type="checkbox" value="{prim_activity}" id ="prim_activity" onchange="getBoundaryDP(this)"><span> {% trans "Primary Activities" %}</span></label>
                          </div> 
                          <!--Restricted access  -->
                          <div class="checkbox">
                            <label><input type="checkbox" value="{public_utilities}" id ="public_utilities" onchange="getBoundaryDP(this)"><span> {% trans "Public Utilities" %}</span></label>
                          </div> 
                          <div class="checkbox">
                            <label><input type="checkbox" value="{social_amenities}" id ="social_amenities" onchange="getBoundaryDP(this)"><span> {% trans "Social Amenities" %}</span></label>
                          </div>
                          <div class="checkbox">
                            <label><input type="checkbox" value="{tranporatation}" id ="tranporatation" onchange="getBoundaryDP(this)"><span> {% trans "Transportation" %} </span></label>
                          </div>
                          </div>
                          <br>
                          <div class="multiselect">
                            <div class="selectBox" onclick="showCheckboxes2()">
                                <button type="button" class="btn btn-outline-dark" style="width: 90%;font-size:12px; "> {% trans "G/South Ward OSM Data" %}</button>
                                <div class="overSelect"></div>
                            </div>

                            <div id="checkboxes2">
                                <div class="checkbox">
                                    <label><input type="checkbox" value="regions" id ="regions" disabled onchange="getOSM(this)"><span> {% trans "Regions" %}</span></label>
                                </div>
                                <div class="checkbox">
                                    <label><input type="checkbox" value="building_cluster" id ="building_cluster" disabled onchange="getOSM(this)"><span> {% trans "Building Cluster" %}</span></label>
                                </div>
                                <div class="checkbox">
                                 <label><b><input type="checkbox" value="buildings" id ="buildings" onchange="getOSM(this)"><span> {% trans "Buildings" %}</span></b></label>
                                </div> 
                                <div class="checkbox">
                                    <label><b><input type="checkbox" value="roads" id ="roads" onchange="getroads(this)"><span> {% trans "Roads" %}</span></b></label>
                                </div>
                            </div>
                      </div>
                     <br>
                     <br>

                      <!-- <button type="button" class="btn btn-primary" id='locate'>{% trans "Your Location" %}</button> -->
                    </div>
                   
                </div> 
                      
            </form>

        
</form>
{% endblock map_content%}
{% block extra_map_javascript%}

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script>
// *****************
let $locate = $('#locate');
let $body = $('body');
let currentPos = null;
let marker = null;
let oldMarker = null;
let oldLayer = null;

// YOUR LOCATION BUTTON
$locate.on('click', function(e) {
    if (oldMarker) {
        mymap.removeLayer(oldMarker);
        oldMarker = null;
    }
    if (oldLayer) {
        mymap.removeLayer(oldLayer);
        oldLayer = null;
        facilityLayer = new L.featureGroup();
    }
    // $status.html('finding your location');
    if (!navigator.geolocation) {
        alert("<p>Sorry, your browser does not support Geolocation</p>");
        return;
    }
    $body.removeClass('loaded');
    navigator.geolocation.getCurrentPosition(success, error);
});

    // IF LOCATION FETCH BY BROWSER SUCCESS
    function success(position) {
    $body.addClass('loaded');
    currentPos = [position.coords.latitude, position.coords.longitude];
    mymap.setView(currentPos, 13);
    marker = L.marker(currentPos)
        .addTo(mymap)
        .bindTooltip("Your Location")
        .openTooltip();
    oldMarker = marker;

};
// IF error IN FETCHING LOCATION
function error() {
    alert("Unable to retrieve your location");
};

const domain = ['https://geoserver2.communitygis.net/', 'http://localhost/'];
    var rootUrl = domain[0] + 'geoserver/geonode/ows';

    var defaultParameters = {
        service: 'WFS',
        version: '1.0.0',
        request: 'GetFeature',
        outputFormat: 'json'
    };

    var wms_legend;
    var info = L.control();
    var attribute_table = L.control({
        position: 'bottomright'
    });
    var LayerList = [];
    var tempParameter = defaultParameters;
    var newLayerList = [];
    var pointLayerList = [];

    var myWorliLayerList = [];
    var popup_layer, content;           
    let  imageloca= [];
    var polylayer =[];
    var polylayer1 =[];
    var polylayer2 =[];
    var areaLayerList=[];
    var cqlfilter;
    

// <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script>
var expanded = false;
// putWMSarea("ward61:ward61_boundary_1nov21");
function showCheckboxes2() { //geographical heirarchy
    var checkboxes = document.getElementById("checkboxes2");
    if (!expanded) {
        checkboxes2.style.display = "block";
        expanded = true;
    } else {
        checkboxes2.style.display = "none";
        expanded = false;
    }
}

function showCheckboxes3() { //geographical heirarchy
    var checkboxes = document.getElementById("checkboxes3");
    if (!expanded) {
        checkboxes3.style.display = "block";
        expanded = true;
    } else {
        checkboxes3.style.display = "none";
        expanded = false;
    }
}

function showCheckboxes7() { //zonal geometry
    var checkboxes = document.getElementById("checkboxes7");
    
    if (!expanded) {
        checkboxes7.style.display = "block";
        expanded = true;
    } else {

        checkboxes7.style.display = "none";
        expanded = false;
    }
}
function getBoundaryru(obj) {
    let boundary = obj.value;
    console.log("boundary is "+boundary)
    if ($(obj).is(":checked")) {

        if (boundary == "{city}")
            putLayer("Mumbai");
        else if (boundary == "{wardGSouth}")    
            putWMSru("geonode:mumbai_ward_boundary");
        // else if (boundary == "{193}")    
        else
            // putWMSru("GSouth:gsouth_corporate_wards");
            putWMSru(boundary);
    }
    else{
        
        if (boundary == "{wardGSouth}")
            removeWMS("geonode:mumbai_ward_boundary");
        else if (boundary == "{city}")
            removeWMS("Mumbai");
        // else if (boundary == "{193}")
        else    
            removeWMS("GSouth:gsouth_corporate_wards");
    }
}
function getBoundaryDP(obj) {
    
    putWMSru("geonode:mumbai_ward_boundary");
    let boundary = obj.value;
    layer = 'geonode:island_city_revised_2_july';
    // console.log(boundary)
    if ($(obj).is(":checked")) {
        layer_name =boundary;
        var wms_layer = L.tileLayer.wms('https://geoserver2.communitygis.net/geoserver/wms', {
                          layers: 'geonode:island_city_revised_2_july',
                          format: 'image/png',
                          
                          transparent: 'true',
                          cql_filter: `layer_name='${boundary}' AND ward_name='GS'`,
                          // cql_filter: `layer_name='${opt}'`,                                        
                          // cql_filter: `district_n=${district}`,                                        
                      });
                      console.log(wms_layer);
                      console.log("layer name is "+layer_name)
                      wms_layer.addTo(mymap);
                      mymap.setView([19.0021,72.8148],14);
                      newLayerList.push(wms_layer);
                      if (wms_legend) 
                        mymap.removeControl(wms_legend);                 
                      addWMSLegend(layer);
                    //   console.log(wms_layer);
    }
    else {
      let boundary = obj.value;
      if (boundary == "education")
        removeFacility("education")
      
        else if (boundary == "health")
        removeFacility("health")
      else if (boundary == "housing")
        removeFacility("housing")  
      else if (boundary == "municipal_services")
        removeFacility("municipal_services")
      else if (boundary == "offices")
        removeFacility("offices")
      else if (boundary == "open_spaces")
        removeFacility("open_spaces")
      else if (boundary == "primary_activities")
        removeFacility("primary_activities")
      else if (boundary == "public_utility_and_facilities")
        removeFacility("public_utility_and_facilities")
      else if (boundary == "social_amenities")
        removeFacility("social_amenities")
      else if (boundary == "transportation")
        removeFacility("transportation")
    //   else if (facility == "fire_station")
    //     removeWards1("fire_station")
    //   else if (facility == "building")
    //     removeLayer("geonode:osm_building_islandcity_14june") 
    //   else if (facility == "roads")
    //     removeLayer("geonode:osm_road_islandcity_14june")      
    }
}

function getroads(obj){
    // function getBoundaryDP(obj) {
    
    putWMSru("geonode:mumbai_ward_boundary");
    let boundary = obj.value;
    layer = 'geonode:island_city_revised_2_july';
    // console.log(boundary)
    if ($(obj).is(":checked")) {
        layer_name =boundary;
        var wms_layer = L.tileLayer.wms('https://geoserver2.communitygis.net/geoserver/wms', {
                          layers: 'geonode:island_city_revised_2_july',
                          format: 'image/png',
                          
                          transparent: 'true',
                          cql_filter: `layer_name='${boundary}' AND ward_name='GS'`,
                          // cql_filter: `layer_name='${opt}'`,                                        
                          // cql_filter: `district_n=${district}`,                                        
                      });
                      console.log(wms_layer);
                      console.log("layer name is "+layer_name)
                      wms_layer.addTo(mymap);
                      mymap.setView([19.0021,72.8148],14);
                      newLayerList.push(wms_layer);
                      if (wms_legend) 
                        mymap.removeControl(wms_legend);                 
                      addWMSLegend(layer);
                    //   console.log(wms_layer);
    }
    else {
      let boundary = obj.value;
      if (boundary == "education")
        removeFacility("education")
      
        else if (boundary == "health")
        removeFacility("health")
      else if (boundary == "housing")
        removeFacility("housing")  
      else if (boundary == "municipal_services")
        removeFacility("municipal_services")
      else if (boundary == "offices")
        removeFacility("offices")
      else if (boundary == "open_spaces")
        removeFacility("open_spaces")
      else if (boundary == "primary_activities")
        removeFacility("primary_activities")
      else if (boundary == "public_utility_and_facilities")
        removeFacility("public_utility_and_facilities")
      else if (boundary == "social_amenities")
        removeFacility("social_amenities")
      else if (boundary == "transportation")
        removeFacility("transportation")
    //   else if (facility == "fire_station")
    //     removeWards1("fire_station")
    //   else if (facility == "building")
    //     removeLayer("geonode:osm_building_islandcity_14june") 
    //   else if (facility == "roads")
    //     removeLayer("geonode:osm_road_islandcity_14june")      
    }

}

function removeFacility(layer_name){
    var a = "layer_name="+"'"+layer_name+"'"+" AND "+"ward_name="+"'GS'";
    console.log(a);
    newLayerList.forEach((layer, index) => {
        if (layer.options.cql_filter === a) {
            mymap.removeLayer(layer);
            if (wms_legend) {
        // alert(wms_legend)
              mymap.removeControl(wms_legend);
            }
            // newLayerList.splice(index, 1);
        }
    });
}
 

function removepolylayer(layer){
    console.log("polylayer is to be removed");
    mymap.removeLayer(layer);
    // mymap.removeControl(wms_legend);
    // mymap.clearLayers();
    // console.log("polylayer is :"+polylayer);
}
function putWMSru(layer) {
    console.log("layer is "+layer)
if (layer == "geonode:mumbai_ward_boundary") {
    var wmslayer = 'geonode:mumbai_ward_boundary';
    currentPos = [19.0182,72.8168]; 
    var maximumzoom = 19;
    var opac = 0.6;
    var zoom = 13;
    cqlfilter = `Name='G/S'`;
    // var wms_layer = L.tileLayer.wms('https://geoserver2.communitygis.net/geoserver/wms', {
    //     // layers: 'geonode:island_city_revised_2_july',
    //     layers: layer,
    //     format: 'image/png',
    //     transparent: 'true',
    //     cql_filter: `Name='G/S'`,
                                             
    // });
}

else{
    // if(layer == "GSouth:gsouth_corporate_wards"){
        var wmslayer ='GSouth:gsouth_corporate_wards';
        console.log("wmslayer is" +wmslayer)
        console.log("layer is" +layer)
        if(layer == '193')
            cqlfilter =`wrd_numbe='193'`;
        if(layer == '194')
            cqlfilter =`wrd_numbe='194'`;
        if(layer == '195')
            cqlfilter =`wrd_numbe='195'`;
        if(layer == '196')
            cqlfilter =`wrd_numbe='196'`;
        if(layer == '197')
            cqlfilter =`wrd_numbe='197'`;
        if(layer == '198')
            cqlfilter =`wrd_numbe='198'`;
        if(layer == '199')
            cqlfilter =`wrd_numbe='199'`;
        else
           cqlfilter = ``;
        console.log("cqlfilter is"+cqlfilter)    ;
        currentPos = [19.0113,72.8184];
        var maximumzoom = 20;
        var opac = 0.5;
        var zoom = 14;
        // var cqlfilter =`wrd_numbe='193'`;
    }
    
    var wms_layer = L.tileLayer.wms('https://geoserver2.communitygis.net/geoserver/wms', {
        // layers: 'geonode:island_city_revised_2_july',
        layers: wmslayer,
        format: 'image/png',
        transparent: 'true',
        cql_filter: cqlfilter,
        
                                             
    });
//     else if (layer == "ward61:ward61_boundary_1nov21") {
//     currentPos = [19.1423,72.8137];
//     var maximumzoom = 20;
//     var opac = 0.5;
//     var zoom = 13;
//     }
//     else if (layer == "ward61:osm_buildings_29oct21") {
//     currentPos = [19.1467,72.8283];
//     layer = "";
//     var maximumzoom = 20;
//     var opac = 0.1;
//     var zoom = 16;
    
//     }
//     else if (layer == "ward61:ward61osmroad25OCT") {
//     currentPos = [19.1467,72.8283];
//     var maximumzoom = 20;
//     var opac = 0.5;
//     var zoom = 16;
//     }
//         // console.log(layer)
//     var wms_layer = L.tileLayer.wms('https://geoserver2.communitygis.net/geoserver/wms', {
//         layers: layer,
//         format: 'image/png',
//         // opacity:0.5,
//         transparent:true,
//         maxZoom:maximumzoom,

//     });
// }
    
        wms_layer.addTo(mymap);
        mymap.setView(currentPos, zoom);
        newLayerList.push(wms_layer);
        popup_layer="https://geoserver2.communitygis.net/geoserver/ward61/wms?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetFeatureInfo&LAYERS=" + wms_layer.options.layers + "&QUERY_LAYERS=" + wms_layer.options.layers;  
        console.log("popupzone",popup_layer);
        console.log(wms_layer);
        if (wms_legend) {
             mymap.removeControl(wms_legend);
        }
        //  mymap.removeControl(legend);
        // addLegend(position ="bottomright", pal = pal, 
                    // values = ~Type,
                    // title = "Zone Types",
                    // opacity = 1)
        addWMSLegend(wmslayer);
}
function removeWMS(unchecked_layer) {
    newLayerList.forEach((layer, index) => {
    if (layer.options.layers === unchecked_layer) {
        // alert(layer,unchecked_layer);
        //  alert("legend is"+wms_legend.value);
        mymap.removeLayer(layer);
        // mymap.removeControl(wms_legend);
        newLayerList.splice(index, 1);
        if (wms_legend) {
            mymap.removeControl(wms_legend);
        }
        addWMSLegend(layer);
        
    }
    });
}
function addWMSLegend(layer) {
    lagendGraphic = "https://geoserver2.communitygis.net/geoserver/wms?REQUEST=GetLegendGraphic&VERSION=1.0.0&FORMAT=image/png&WIDTH=20&HEIGHT=20&LAYER=" + layer + "&LEGEND_OPTIONS=forceLabels:on";
    wms_legend = L.wmsLegend(lagendGraphic);
}
function putLayer(opt){
    console.log("opt is "+opt);
    var wms_layer = L.tileLayer.wms('https://geoserver2.communitygis.net/geoserver/wms', {
        // layers: 'geonode:island_city_revised_2_july',
        layers: 'geonode:maha_taluka_13march2021',
        format: 'image/png',
        transparent: 'true',
        cql_filter: `distname='${opt}'`,
        
    });
    wms_layer.addTo(mymap);
    // wardLayerList.push(wms_layer);
    console.log(wms_layer);
    // if(opt == 'Mumbai')
    //   mymap.setView([19.0110, 72.8512], 12);
      
    // else
      mymap.setView([18.9805, 72.816], 12);

}

// mymap.addEventListener('click', Identify);
// function for displaying spots

    
function Identify(e) {
    
    console.log("Identify",e);
    // set parameters needed for GetFeatureInfo WMS request
    var sw = mymap.options.crs.project(mymap.getBounds().getSouthWest());
    var ne = mymap.options.crs.project(mymap.getBounds().getNorthEast());
    var BBOX = sw.x + "," + sw.y + "," + ne.x + "," + ne.y;
    var WIDTH = mymap.getSize().x;
    var HEIGHT = mymap.getSize().y;

    var X = Math.trunc(mymap.layerPointToContainerPoint(e.layerPoint).x);
    var Y = Math.trunc(mymap.layerPointToContainerPoint(e.layerPoint).y);

    // compose the URL for the request
    

    var URL = popup_layer + '&BBOX=' + BBOX + '&FEATURE_COUNT=1&HEIGHT=' + HEIGHT + '&WIDTH=' + WIDTH + '&INFO_FORMAT=application%2Fjson&TILED=false&CRS=EPSG%3A3857&I=' + X + '&J=' + Y;
    // console.log(URL);
    //send GetFeatureInfo as asynchronous HTTP request using jQuery $.ajax
    $.ajax({
        url: URL,
        dataType: "json",
        type: "GET",
        success: function(data) {
            if (data.features.length !== 0) { // at least one feature returned in response
                var feature = data.features[0]; // first feature from response
                console.log(feature);
                // Set up popup for clicked feature and open it
                var popup = new L.Popup({
                    maxWidth: 300
                });
                if (feature.properties.region) {
                    // alert("in region");
                    content = "<table class = 'popupclass' ><tr><td><b>Region Info</b></td><td></td></tr>" +
                        "<tr><td><b>Region Name: </b></td><td>" + feature.properties.region + "</td></tr>"+"</table>";
                    popup.setContent(content);
                    popup.setLatLng(e.latlng);
                    mymap.openPopup(popup);
                    }
                if (feature.properties.building_name) {
                    
                    // console.log("I reached at");
                    content = "<table class = 'popupclass' ><tr><td><b>Buildings Info</b></td><td></td></tr>" +
                        "<tr><td><b>Building Name: </b></td><td>" + feature.properties.name + "</td></tr>"+
                        "<tr><td><b>Description: </b></td><td>"+feature.properties.building + "</td></tr>"+
                        "<tr><td><b>Region: </b></td><td>" + feature.properties.region + "</td></tr>"+
                        "<tr><td><b>Number of Flats/shops: </b></td><td>" + feature.properties.flats + "</td></tr>"+
                        "<tr><td><b>Number of Wings></td><td>" + feature.properties.wings + "</td></tr>"+
                        "<tr><td><b>Address: </b></td><td>" + feature.properties.address + "</td></tr>"+
                        "<tr><td><b>MODIFY: </b></td><td><a href = '/buildedit/"+feature.properties.osm_id+"' style ='color:#FF0000;'>" + feature.properties.osm_id + "</a></td></tr>"+
                        "<tr><td rowspan=2><a href = '/buildedit/"+feature.properties.osm_id+"' style ='color:#FF0000;'>" + feature.properties.osm_id + "</a></td></tr>"+
                        "</table>";
                popup.setContent(content);
                popup.setLatLng(e.latlng);
                mymap.openPopup(popup);
                }
            }
        }
    });
}

    
// function displaypolygon_buildings_noname(){
//     let osm_buildings = JSON.parse('{{ geojson|safe }}')
//     // console.log(osm_buildings)
//     // alert(osm_buildings);
//     // mymap.removeLayer(polylayer);
//     mymap.setView([19.1467,72.8283],16);
//     // mymap.clearLayers();
//     polylayer1 = L.geoJSON(osm_buildings, 
//     {style:function(feature){
//         switch(feature.properties.building){
//             case 'residence':return {color:"#FF0000"};
//             case 'residential':return {color:"#FF0000"};
//             case 'apartments':return {color:"#FF0000"};
//             // case 'yes':return {color:"#c83daa"};
//             case 'commercial':return {color:"#FF0000"};
//             case 'Commercial':return {color:"#FF0000"};
//             case 'office':return {color:"#FF0000"};
//             case 'yes':return {color:"#FF0000"};
//             case 'school':return {color:"#FF0000"};
//             }
//         },    
        
//         onEachFeature: onEachFeatureForPointBB,
//         filter: NonameBuildingFilter,
//     // }).addTo(mymap);
//     });
//     console.log("polylayer1 is "+polylayer1);
//     polylayer1.addTo(mymap);
    
// }
// function displaypolygon_regions_noname(){
//     let osm_buildings = JSON.parse('{{ geojson|safe }}')
//     // console.log(osm_buildings)
//     // alert(osm_buildings);
//     // mymap.removeLayer(polylayer);
//     mymap.setView([19.1467,72.8283],16);
//     // mymap.clearLayers();
//     polylayer2 = L.geoJSON(osm_buildings, 
//     {style:function(feature){
//         switch(feature.properties.building){
//             case 'residence':return {color:"#FF0000"};
//             case 'residential':return {color:"#FF0000"};
//             case 'apartments':return {color:"#FF0000"};
//             // case 'yes':return {color:"#c83daa"};
//             case 'commercial':return {color:"#FF0000"};
//             case 'Commercial':return {color:"#FF0000"};
//             case 'office':return {color:"#FF0000"};
//             case 'yes':return {color:"#FF0000"};
//             case 'school':return {color:"#FF0000"};
//             }
//         },    
        
//         onEachFeature: onEachFeatureForPointBB,
//         filter: NonameRegionFilter,
//     // }).addTo(mymap);
//     });
//     console.log("polylayer2 is "+polylayer2);
//     polylayer2.addTo(mymap);
    
// }
// function getOSM(obj){
//     let boundary = obj.value;
//     console.log(boundary)
//     if ($(obj).is(":checked")) {
//         if (boundary == "buildings"){
//             // putWMSru("ward61:osm_buildings_29oct21"); 
//             displaypolygon();
//             console.log("Disaply polygon called")
//         }
//     }
//     else
//         removepolylayer(polylayer);
// }
function getOSM(){
  layer = 'geonode:mumbai_ward_boundary';
   putWMSru(layer);
   
    let osm_buildings = JSON.parse('{{ geojson|safe }}')
    console.log(osm_buildings)
    // alert(osm_buildings);
    // mymap.removeLayer(polylayer);
    mymap.setView([19.1467,72.8283],16);
    // mymap.clearLayers();
    polylayer = L.geoJSON(osm_buildings, 
    {style:function(feature){
      console.log("category is "+feature.properties.building_category)
        switch(feature.properties.building_category){
            case 'residence':return {color:"#c83daa"};
            case 'residential':return {color:"#c83daa"};
            case 'apartments':return {color:"#c83daa"};
            case 'yes':return {color:"#c83daa"};
            case 'commercial':return {color:"#55e232"};
            // case 'Commercial':return {color:"#55e232"};
            case 'office':return {color:"#7d3fe9"};
            case 'yes':return {color:"#1d80e3"};
            case 'school':return {color:"#efe115"};
            case 'hotel':return {color: "#d48b6b"};
            case 'mosque':return{color:"#227627"};
            }
          switch(feature.properties.building_name){
            case null:return{color:'#ff0000'};
          }
        },    
        
        onEachFeature: onEachFeatureForPointBB,
    // }).addTo(mymap);
    });
    polylayer.addTo(mymap);
    mymap.setView([19.0111, 72.8252],15);
    // layer ="ward61:osm_buildings_29oct21";
    // addWMSLegend(layer);
}
// function NonameBuildingFilter(feature) {
//     // alert(layer.properties.name+"="+feature);
//     // layer.on({click:onClick })
//     console.log("Name is ");
//     if(feature.properties.name !== null) 
//         return false    
//     else
//         return true
// }
// function NonameRegionFilter(feature){
//     console.log("Region is ")
//     if(feature.properties.region !== null)
//         return false
//     else    
//         return true
// }
function onClick(e) {console.log("Onclick")

        alert(e);
        mymap.clearLayers();
        // mymap.removeLayer(layer);
    }
    function displaypolygon(){
    let osm_buildings = JSON.parse('{{ geojson|safe }}')
    // console.log(osm_buildings)
    // alert(osm_buildings);
    // mymap.removeLayer(polylayer);
    mymap.setView([19.1467,72.8283],16);
    // mymap.clearLayers();
    polylayer = L.geoJSON(osm_buildings, 
    {style:function(feature){
      console.log("category is "+feature.properties.building_category)
        switch(feature.properties.building_category){
            case 'residence':return {color:"#c83daa"};
            case 'residential':return {color:"#c83daa"};
            case 'apartments':return {color:"#c83daa"};
            case 'yes':return {color:"#c83daa"};
            case 'commercial':return {color:"#55e232"};
            case 'Commercial':return {color:"#55e232"};
            case 'office':return {color:"#7d3fe9"};
            case 'yes':return {color:"#1d80e3"};
            case 'school':return {color:"#efe115"};
            }
        },    
        
        onEachFeature: onEachFeatureForPointBB,
    // }).addTo(mymap);
    });
    polylayer.addTo(mymap);
    
    // layer ="ward61:osm_buildings_29oct21";
    // addWMSLegend(layer);
}
function onEachFeatureForPointBB(feature, layer) {
    // alert(layer.properties.name+"="+feature);
    // layer.on({click:onClick })
    // if(${feature.properties.name} !== null){
      layer.bindPopup(`<div class = 'text-left'><table border =2><tr class="bg-primary"><td colspan=2>Building Information</td></tr>
    <tr class="table-danger"><td>Building Name:</td><td> ${feature.properties.building_name}</td></tr>
    <tr class="bg-primary"><td>Building Type :</td><td>${feature.properties.building_category}</td></tr>
    <tr class="table-danger"><td>Ward:</td><td>${feature.properties.ward}</td></tr>
    <tr class="bg-primary"><td>Region:</td><td>${feature.properties.region}</td></tr>
    <tr class="table-danger"><td>Building Cluster:</td><td>${feature.properties.building_cluster}</td></tr>
    <tr class="bg-primary"><td>Number of Flats :</td><td>${feature.properties.num_flats_building}</td></tr>
    <tr class="table-danger"><td>Number of shops :</td><td>${feature.properties.num_shops_building}</td></tr>
    <tr class="bg-primary"><td>Number of Wings :</td><td>${feature.properties.wing}</td></tr>
   
    <tr colspan =2></tr>
    <tr ><td colspan =2><b><center><a href = '/buildedit/${feature.properties.osm_id}' class="btn btn-info">Update Building Details</a></center></td></tr>
    <tr ><td colspan =2 ><a href='/garbage_seg/' class="btn btn-success">Add Waste Segregation Details</a></td></tr></table>
</div>`)
    // }
    

}

 mymap.addEventListener('click', Identify);

</script>
{% endblock extra_map_javascript %}
